# Connectome Lab HPC Workshop

μ•λ…•ν•μ„Έμ”! π μ΄λ΅ μΌλ΅ λ°°μ΄ λ‚΄μ©μ„ μ°λ¦¬ λ© μ„λ²„μ—μ„ μ§μ ‘ κ²½ν—ν•΄λ³΄λ” μ‹κ°„μ΄μ—μ”!
μ΄λ² μ‹¤μµμ—μ„λ” Slurm μ¤ν¬λ¦½νΈλ¥Ό μ‘μ„±ν•κ³  μ μ¶ν•λ” λ‹¤μ–‘ν• λ°©λ²•λ“¤μ„ λ‹¨κ³„λ³„λ΅ μ•μ•„λ³Ό κ±°μμ”. κΈ°λ³Έμ μΈ μ¤ν¬λ¦½νΈλ¶€ν„° μ‹μ‘ν•΄μ„, λ©€ν‹° λ…Έλ“ μ‘μ—…, μ²΄κ³„μ μΈ μ‹¤ν— μ μ¶ λ°©λ²•κΉμ§€ ν•¨κ» μ‚΄ν΄λ΄…μ‹λ‹¤!

**π― μ‹¤μµ λ©ν‘**

*   λ‹¤μ–‘ν• μ ν•μ Slurm μ¤ν¬λ¦½νΈλ¥Ό μ΄ν•΄ν•κ³  μ‘μ„±/μμ •ν•  μ μλ‹¤.
*   κ° μ¤ν¬λ¦½νΈμ μ‚¬μ© λ©μ κ³Ό μ¥λ‹¨μ μ„ νμ•…ν•λ‹¤.
*   `sbatch`, `srun`, Slurm ν™κ²½ λ³€μ λ“±μ κΈ°λ³Έ κ°λ…μ„ μ‹¤μ  μ¤ν¬λ¦½νΈλ¥Ό ν†µν•΄ μµνλ‹¤.

**β… μ¤€λΉ„λ¬Ό**

*   λ© μ„λ²„μ— SSHλ΅ μ ‘μ†λ ν„°λ―Έλ„ μ°½ π’»
*   κ°„λ‹¨ν• ν…μ¤νΈ νΈμ§‘κΈ° μ‚¬μ© λ¥λ ¥ (nano λλ” vim μ¶”μ²!)
*   ν„°λ―Έλ„ κΈ°λ³Έ λ…λ Ήμ–΄ (`cd`, `ls`, `mkdir`, `cat`, `cp`, `chmod`) μ‚¬μ© λ¥λ ¥
*   **(μ¤‘μ”!)** μ κ³µλ μ‹¤μµμ© μ¤ν¬λ¦½νΈ νμΌλ“¤ (`0-setup.sh`, `1-*.sh`, `2-*.sh`, `3-*.sh`, `4-*.sh`) μ΄ μ‹¤μµ λ””λ ‰ν† λ¦¬μ— μ¤€λΉ„λμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤!

---

### 0. μ‚¬μ „ μ„Έν… β™οΈ

μ‹¤μµμ„ μ›ν™ν•κ² μ§„ν–‰ν•κΈ° μ„ν•΄, ν•„μ”ν• λ””λ ‰ν† λ¦¬λ¥Ό λ§λ“¤κ³  μ¤ν¬λ¦½νΈ νμΌμ— μ‹¤ν–‰ κ¶ν•μ„ λ¶€μ—¬ν•©μ‹λ‹¤!

- **μ‹¤μµ λ””λ ‰ν† λ¦¬ μƒμ„± λ° μ΄λ™:**

```bash
# λ©μ„λ²„ SCRATCH λ””λ ‰ν† λ¦¬μ—μ„ μ‹μ‘ν•λ‹¤κ³  κ°€μ •ν•©λ‹λ‹¤.
cd $SCRATCH
git clone https://github.com/jubilant-choi/HPC_Workshop.git
cd HPC_Workshop
chmod +x 0-setup.sh
bash 0-setup.sh
```
*   νν† λ¦¬μ–Όμ„ μ§„ν–‰ν•  μ„μΉλ΅ μ΄λ™ν• ν›„, μ΄ κΉƒν—™ λ ν¬λ¥Ό ν΄λ΅ ν•΄μ£Όμ„Έμ”.
*   μ΄ν›„ HPC_Workshop ν΄λ”λ΅ μ΄λ™ν• ν›„ 0-setup.shμ κ¶ν•μ„ λ³€κ²½ν•΄μ£Όμ„Έμ”.
*   κ·Έ λ‹¤μ  0-setup.sh νμΌμ„ μ‹¤ν–‰ν•΄μ£Όμ„Έμ”.
*   `logs`, `logs/systematic`, `logs/multiple_srun` λ””λ ‰ν† λ¦¬κ°€ μƒμ„±λ©λ‹λ‹¤. κ° μ‹¤μµ λ‹¨κ³„μ λ΅κ·Έ νμΌμ΄ μ΄κ³³μ— μ €μ¥λ  κ±°μμ”.
*   λν• μ΄μ  λ¨λ“  `.sh` νμΌλ“¤μ΄ μ‹¤ν–‰ κ°€λ¥ν• μƒνƒκ°€ λμ—μµλ‹λ‹¤! β¨
*   `ls *.sh` λ…λ Ήμ–΄λ΅ νμΌλ“¤μ΄ μ μλ”μ§€ ν™•μΈν•΄λ³΄μ„Έμ”!

---

### 1. μ¬λΌ μ¤ν¬λ¦½νΈ κΈ°λ³Έ π“ (`1-basic_sbatch.sh`)

κ°€μ¥ κΈ°λ³Έ ν•νƒμ Slurm μ¤ν¬λ¦½νΈμ…λ‹λ‹¤. **ν•λ‚μ λ…Έλ“**μ—μ„ **ν•λ‚μ μ‘μ—…**μ„ μ‹¤ν–‰ν•λ” λ°©λ²•μ„ λ³΄μ—¬μ¤λ‹λ‹¤.

*   **μ¤ν¬λ¦½νΈ μ‚΄ν΄λ³΄κΈ°:** `cat 1-basic_sbatch.sh` λ…λ Ήμ–΄λ΅ λ‚΄μ©μ„ ν™•μΈν•΄λ³΄μ„Έμ”.
    *   `#SBATCH` μ§€μ‹μ–΄λ“¤: μ‘μ—… μ΄λ¦„(`-J`), μ‚¬μ©ν•  νν‹°μ…(`-p`), μμƒ μ‹κ°„(`-t`), μ‚¬μ©ν•  λ…Έλ“ μ(`-N`), λ΅κ·Έ νμΌ κ²½λ΅(`-o`, `-e`) λ“±μ„ μ„¤μ •ν•©λ‹λ‹¤.
        *   **κΏ€νπ―:** `-D` μµμ…μΌλ΅ μ‘μ—… λ””λ ‰ν† λ¦¬λ¥Ό μ§€μ •ν•λ©΄ νΈλ¦¬ν•΄μ”!
        *   **κΏ€νπ―:** λ΅κ·Έ νμΌ μ΄λ¦„μ— `%x` (Job μ΄λ¦„), `%j` (Job ID)λ¥Ό μ‚¬μ©ν•λ©΄ κµ¬λ¶„μ΄ μ‰¬μ›μ”!
    *   **ν™κ²½ μ„¤μ • μ£Όμ„:** μ‹¤μ λ΅λ” μ΄ λ¶€λ¶„μ— `module load`λ‚ `conda activate` κ°™μ€ λ…λ Ήμ–΄λ¥Ό λ„£μ–΄ μ‹¤ν— ν™κ²½μ„ λ§μ¶°μ¤λ‹λ‹¤.
    *   **μ‹¤ν–‰ λ…λ Ήμ–΄:** `echo`, `hostname`, `date`, `sleep` λ“± κ°„λ‹¨ν• λ…λ Ήμ–΄λ“¤μ„ μ‹¤ν–‰ν•©λ‹λ‹¤.
    *   `env | grep SLURM`: Slurmμ΄ μ κ³µν•λ” ν™κ²½ λ³€μλ“¤μ„ ν™•μΈν•΄λ³Ό μ μμ–΄μ”!

*   **μ¤ν¬λ¦½νΈ μ μ¶ λ° ν™•μΈ:**
    ```bash
    # <λ©μ„λ²„_νν‹°μ…μ΄λ¦„> λ¶€λ¶„μ„ μ‹¤μ  νν‹°μ… μ΄λ¦„μΌλ΅ μμ •ν–λ”μ§€ λ‹¤μ‹ ν™•μΈ!
    nano 1-basic_sbatch.sh # ν•„μ”μ‹ μμ •
    sbatch 1-basic_sbatch.sh
    squeue -u $USER # μ‘μ—… μƒνƒ ν™•μΈ
    # μ μ‹ κΈ°λ‹¤λ¦° ν›„...
    ls -l logs/ # λ΅κ·Έ νμΌ μƒμ„± ν™•μΈ
    cat logs/<λ΅κ·ΈνμΌλ…>.o # μ‹¤μ  λ΅κ·Έ νμΌ μ΄λ¦„μΌλ΅ λ°”κΏ”μ„ λ‚΄μ© ν™•μΈ
    ```
*   **ν•µμ‹¬:** Slurm μ¤ν¬λ¦½νΈμ κΈ°λ³Έ κµ¬μ΅°μ™€ `#SBATCH` μµμ… μ„¤μ •λ²•, κ·Έλ¦¬κ³  μ‘μ—… μ μ¶ λ° κ²°κ³Ό ν™•μΈμ κΈ°λ³Έ νλ¦„μ„ μ΄ν•΄ν•λ” κ²ƒμ΄ λ©ν‘μ…λ‹λ‹¤! π

---

### 2. `srun`μΌλ΅ λ©€ν‹°νƒμ¤ν¬/λ©€ν‹°λ…Έλ“ μ‹¤ν–‰ν•κΈ° π€ (`2-using_srun_sbatch.sh`, `2-srun_example.sh`)

μ΄λ²μ—λ” **μ—¬λ¬ λ…Έλ“**μ— κ±Έμ³ **μ—¬λ¬ κ°μ Task(ν”„λ΅μ„Έμ¤)**λ¥Ό μ‹¤ν–‰ν•λ”, μ†μ„ 'λ¶„μ‚°(Distributed)' μ‘μ—…μ κΈ°μ΄λ¥Ό μ•μ•„λ΄…λ‹λ‹¤. `sbatch` μ¤ν¬λ¦½νΈκ°€ ν™κ²½μ„ μ„¤μ •ν•κ³ , `srun` λ…λ Ήμ–΄κ°€ μ‹¤μ  μ‘μ—…μ„ λ³‘λ ¬λ΅ μ‹¤ν–‰μ‹ν‚¤λ” κµ¬μ΅°μ…λ‹λ‹¤. (MPIλ‚ PyTorch DDP κ°™μ€ λ¶„μ‚° ν•™μµμ κΈ°λ³Έ μ›λ¦¬!)

*   **μ¤ν¬λ¦½νΈ μ‚΄ν΄λ³΄κΈ°:**
    *   `cat 2-using_srun_sbatch.sh`:
        *   `#SBATCH -N 2`: **2κ°μ λ…Έλ“**λ¥Ό μ”μ²­ν•©λ‹λ‹¤!
        *   `#SBATCH --ntasks-per-node=2`: **λ…Έλ“λ‹Ή 2κ°μ Task**λ¥Ό μ‹¤ν–‰ν•λ„λ΅ μ”μ²­ν•©λ‹λ‹¤ (μ΄ 4κ° Task).
        *   **Master Node μ£Όμ† μ°ΎκΈ°:** `scontrol show hostnames`, `srun hostname --ip-address` λ“±μ„ μ΅°ν•©ν•μ—¬ λ¶„μ‚° μ‘μ—…μ κΈ°μ¤€μ (Master)μ΄ λ  λ…Έλ“μ IP μ£Όμ†λ¥Ό μ°Ύμµλ‹λ‹¤. (λ¶„μ‚° ν™κ²½ μ„¤μ •μ ν•µμ‹¬!)
        *   **`srun` λ…λ Ήμ–΄:** `-n` (μ΄ Task μ), `-N` (μ΄ λ…Έλ“ μ) λ“±μ μµμ…κ³Ό ν•¨κ», μ‹¤μ  μ‘μ—…μ„ μν–‰ν•  **μ›μ»¤ μ¤ν¬λ¦½νΈ (`2-srun_example.sh`)**λ¥Ό νΈμ¶ν•©λ‹λ‹¤. Master IP μ£Όμ†λ¥Ό μΈμλ΅ λ„κ²¨μ¤λ‹λ‹¤.
    *   `cat 2-srun_example.sh`:
        *   `srun`μ— μν•΄ **κ° Taskμ—μ„ κ°λ³„μ μΌλ΅ μ‹¤ν–‰**λλ” μ¤ν¬λ¦½νΈμ…λ‹λ‹¤.
        *   `$1`: `sbatch` μ¤ν¬λ¦½νΈμ—μ„ λ„κ²¨μ¤€ Master IP μ£Όμ†λ¥Ό λ°›μµλ‹λ‹¤.
        *   **Slurm ν™κ²½ λ³€μ ν™μ©:** `$SLURM_PROCID` (μ „μ²΄ Rank), `$SLURM_LOCALID` (λ…Έλ“ λ‚΄ Local Rank), `$SLURM_NTASKS` (μ „μ²΄ Task μ = World Size) λ“±μ„ ν™μ©ν•μ—¬ κ° Taskκ°€ μμ‹ μ μ—­ν• (Rank)μ„ μΈμ§€ν•κ³  λ¶„μ‚° μ‘μ—…μ„ μν–‰ν•κ² λ©λ‹λ‹¤.
        *   `echo`λ¥Ό ν†µν•΄ κ° Rankκ°€ μ–΄λ–¤ μ •λ³΄λ¥Ό κ°€μ§€κ³  μλ”μ§€ μ¶λ ¥ν•©λ‹λ‹¤. (μ‹¤μ λ΅λ” μ—¬κΈ°μ— `python λ¶„μ‚°ν•™μµμ½”λ“.py ...`κ°€ λ“¤μ–΄κ°‘λ‹λ‹¤.)

*   **μ¤ν¬λ¦½νΈ μ μ¶ λ° ν™•μΈ:**
    ```bash
    # νν‹°μ… μ΄λ¦„, λ…Έλ“ λ©λ΅(--nodelist) λ“±μ„ λ© μ„λ²„ ν™κ²½μ— λ§κ² μμ •ν–λ”μ§€ ν™•μΈ!
    nano 2-using_srun_sbatch.sh # ν•„μ”μ‹ μμ •
    sbatch 2-using_srun_sbatch.sh
    squeue -u $USER
    # μ μ‹ κΈ°λ‹¤λ¦° ν›„...
    ls -l logs/
    cat logs/<λ΅κ·ΈνμΌλ…>.o # μ΄ 4κ°μ Taskμ—μ„ μ¶λ ¥ν• λ©”μ‹μ§€ ν™•μΈ! (Rank 0, 1, 2, 3)
    ```
*   **ν•µμ‹¬:** `sbatch` μ¤ν¬λ¦½νΈκ°€ μ „μ²΄ νμ„ κΉ”κ³ (`-N`, `--ntasks-per-node`), `srun`μ΄ κ° Taskμ—κ² μ—­ν• μ„ λ¶€μ—¬ν•λ©°(`SLURM_*` λ³€μλ“¤) μ‹¤μ  μ‘μ—…μ„ λ³‘λ ¬λ΅ μ‹¤ν–‰μ‹ν‚¤λ” κ³Όμ •μ„ μ΄ν•΄ν•λ” κ²ƒμ΄ μ¤‘μ”ν•©λ‹λ‹¤! β¨

---

### 3. μ²΄κ³„μ μΈ μ‹¤ν— μ μ¶ (λ°©λ²• 1: μ™Έλ¶€ μ¤ν¬λ¦½νΈλ΅ `sbatch` λ°λ³µ νΈμ¶) π”„ (`3-systematic_sbatch.sh`, `3-srun_hyperparams.sh`, `3-iter_sbatch_helper.sh`)

ν•μ΄νΌνλΌλ―Έν„° νλ‹μ²λΌ **λ™μΌν• κµ¬μ΅°μ μ‘μ—…μ„ νλΌλ―Έν„°λ§ λ°”κΏ”κ°€λ©° μ—¬λ¬ λ² λ…λ¦½μ μΌλ΅ μ‹¤ν–‰**ν•κ³  μ‹¶μ„ λ• μ‚¬μ©ν•λ” λ°©λ²• μ¤‘ ν•λ‚μ…λ‹λ‹¤. μ™Έλ¶€ ν—¬νΌ μ¤ν¬λ¦½νΈ(`bash`)κ°€ `sbatch` λ…λ Ήμ–΄λ¥Ό λ°λ³µ νΈμ¶ν•μ—¬ **μ—¬λ¬ κ°μ λ…λ¦½μ μΈ Slurm Job**μ„ μƒμ„±ν•©λ‹λ‹¤.

*   **μ¤ν¬λ¦½νΈ μ‚΄ν΄λ³΄κΈ°:**
    *   `cat 3-iter_sbatch_helper.sh`:
        *   **μ΄ μ¤ν¬λ¦½νΈλ” `sbatch`λ΅ μ μ¶ν•λ” κ²ƒμ΄ μ•„λ‹λΌ, ν„°λ―Έλ„μ—μ„ `bash`λ΅ μ§μ ‘ μ‹¤ν–‰ν•©λ‹λ‹¤!**
        *   Bash λ°°μ—΄(`lrs`, `wds`, `masks`)λ΅ νλ‹ν•  ν•μ΄νΌνλΌλ―Έν„° λ©λ΅μ„ μ •μν•©λ‹λ‹¤.
        *   **μ¤‘μ²© `for` λ£¨ν”„:** λ¨λ“  νλΌλ―Έν„° μ΅°ν•©μ„ μνν•©λ‹λ‹¤.
        *   λ£¨ν”„ λ‚΄λ¶€μ—μ„ **`sbatch` λ…λ Ήμ–΄ νΈμ¶:** κ° μ΅°ν•©μ— λ€ν•΄ `3-systematic_sbatch.sh` μ¤ν¬λ¦½νΈλ¥Ό μ μ¶ν•©λ‹λ‹¤. μ΄λ•, `--job-name`μ„ μ„¤μ •ν•κ³  **νλΌλ―Έν„°λ“¤μ„ μ»¤λ§¨λ“ λΌμΈ μΈμ**λ΅ λ„κ²¨μ¤λ‹λ‹¤!
    *   `cat 3-systematic_sbatch.sh`:
        *   `iter_sbatch_helper.sh`μ— μν•΄ **κ°λ³„ JobμΌλ΅ μ μ¶λλ”** μ¤ν¬λ¦½νΈμ…λ‹λ‹¤.
        *   μ¤ν¬λ¦½νΈ μ•λ¶€λ¶„μ€ μ΄μ „ μμ λ“¤κ³Ό μ μ‚¬ν•©λ‹λ‹¤ (μμ› μ”μ²­, ν™κ²½ μ„¤μ • λ“±).
        *   **`$1`, `$2`, `$3`**: ν—¬νΌ μ¤ν¬λ¦½νΈμ—μ„ λ„κ²¨μ¤€ μ»¤λ§¨λ“ λΌμΈ μΈμ(lr, wd, mask_ratio)λ¥Ό λ°›μµλ‹λ‹¤!
        *   `srun`μ„ μ‚¬μ©ν•μ—¬ μ›μ»¤ μ¤ν¬λ¦½νΈ(`3-srun_hyperparams.sh`)λ¥Ό νΈμ¶ν•λ©°, λ°›μ€ νλΌλ―Έν„°λ“¤μ„ λ‹¤μ‹ λ„κ²¨μ¤λ‹λ‹¤.
    *   `cat 3-srun_hyperparams.sh`:
        *   `srun`μ— μν•΄ κ° Taskμ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.
        *   Master μ£Όμ† μ™Έμ— μ¶”κ°€μ μΈ ν•μ΄νΌνλΌλ―Έν„° μΈμλ“¤(`$2`, `$3`, `$4`)μ„ λ°›μµλ‹λ‹¤.
        *   λ°›μ€ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤ (μ: `NEPTUNE_CUSTOM_RUN_ID` μ„¤μ •, λ΅κ·Έ μ¶λ ¥ λ“±).

*   **μ‹¤ν–‰ λ°©λ²• λ° ν™•μΈ:**
    ```bash
    # 3-systematic_sbatch.sh μ•μ νν‹°μ… λ“±μ„ ν™κ²½μ— λ§κ² μμ •ν–λ”μ§€ ν™•μΈ!
    nano 3-systematic_sbatch.sh # ν•„μ”μ‹ μμ •

    # ν—¬νΌ μ¤ν¬λ¦½νΈλ¥Ό bashλ΅ μ‹¤ν–‰ν•μ—¬ μ—¬λ¬ sbatch μ‘μ—…μ„ μ μ¶!
    bash 3-iter_sbatch_helper.sh

    # squeueλ΅ ν™•μΈν•λ©΄ μ—¬λ¬ κ°μ Jobμ΄ μƒμ„±λ κ²ƒμ„ λ³Ό μ μμ!
    squeue -u $USER

    # μ μ‹ κΈ°λ‹¤λ¦° ν›„ logs/systematic/ λ””λ ‰ν† λ¦¬ ν™•μΈ
    ls -l logs/systematic/
    # κ° Jobμ λ΅κ·Έ νμΌ λ‚΄μ©μ„ catμΌλ΅ ν™•μΈ
    ```
*   **ν•µμ‹¬:** μ™Έλ¶€ μ‰ μ¤ν¬λ¦½νΈλ¥Ό μ΄μ©ν•΄ **μ—¬λ¬ κ°μ λ…λ¦½μ μΈ Slurm Job**μ„ μλ™μΌλ΅ μƒμ„±ν•κ³  μ μ¶ν•λ” λ°©λ²•μ…λ‹λ‹¤. κ° Jobμ€ μ μ¶ μ‹ μ „λ‹¬λ°›μ€ νλΌλ―Έν„°λ΅ μ‹¤ν–‰λ©λ‹λ‹¤. Job Arrayμ™€ λ‹¬λ¦¬ κ° μ‹¤ν—μ΄ μ™„μ „ν λ¶„λ¦¬λμ–΄ κ΄€λ¦¬λ©λ‹λ‹¤.

---

### 4. μ²΄κ³„μ μΈ μ‹¤ν— μ μ¶ (λ°©λ²• 1: Job Array ν™μ©) β¨ (`4-jobarray_sbatch.sh`)

ν•μ΄νΌνλΌλ―Έν„° νλ‹κ³Ό κ°™μ΄ **λ™μΌν• μ‘μ—…μ„ νλΌλ―Έν„°λ§ λ°”κΏ”μ„ μ—¬λ¬ λ² μ‹¤ν–‰**ν•  λ• κ°€μ¥ **ν‘μ¤€μ μ΄κ³  κ¶μ¥λλ”** λ°©λ²•μ…λ‹λ‹¤. **ν•λ‚μ `sbatch` μ μ¶**λ΅ **μ—¬λ¬ κ°μ Task**λ¥Ό μƒμ„±ν•κ³  κ΄€λ¦¬ν•©λ‹λ‹¤.

*   **μ¤ν¬λ¦½νΈ μ‚΄ν΄λ³΄κΈ°:** `cat 4-jobarray_sbatch.sh` λ…λ Ήμ–΄λ΅ λ‚΄μ©μ„ ν™•μΈν•΄λ³΄μ„Έμ”.
    *   **`#SBATCH --array=1-4`**: ν•µμ‹¬! 1λ²λ¶€ν„° 4λ²κΉμ§€, μ΄ 4κ°μ Taskλ¥Ό μƒμ„±ν•λΌλ” μ§€μ‹μ…λ‹λ‹¤. μ΄ Jobμ€ ν•λ‚μ Job IDλ¥Ό κ³µμ ν•μ§€λ§, κ° Taskλ” κ³ μ ν• Task ID (1, 2, 3, 4)λ¥Ό κ°–μµλ‹λ‹¤.
    *   **`#SBATCH --output`, `--error`**: λ΅κ·Έ νμΌ μ΄λ¦„μ— `%A` (Array Job ID)μ™€ **`%a` (Task ID)**λ¥Ό λ„£μ–΄ κ° Taskμ λ΅κ·Έκ°€ λ³„λ„λ΅ μ €μ¥λλ„λ΅ μ„¤μ •ν•  μ μμµλ‹λ‹¤. (`logs/systematic/%x-%A_%a.o`)
    *   **Bash λ°°μ—΄:** `learning_rates`, `batch_sizes` λ°°μ—΄μ— νλ‹ν•  νλΌλ―Έν„° κ°’λ“¤μ„ μ €μ¥ν•©λ‹λ‹¤.
    *   **`$SLURM_ARRAY_TASK_ID` ν™μ©:** Slurmμ΄ κ° Taskμ—κ² μλ™μΌλ΅ λ¶€μ—¬ν•λ” μ΄ ν™κ²½ λ³€μ κ°’μ„ μ½μ–΄μµλ‹λ‹¤.
    *   **νλΌλ―Έν„° λ§¤ν•‘:** Task ID (`$SLURM_ARRAY_TASK_ID`, 1λ¶€ν„° μ‹μ‘)λ¥Ό λ°°μ—΄ μΈλ±μ¤ (`$task_id - 1`, 0λ¶€ν„° μ‹μ‘)λ΅ λ³€ν™ν•μ—¬, κ° Taskκ°€ μ‹¤ν–‰λ  λ• μ‚¬μ©ν•  κ³ μ ν• νλΌλ―Έν„° κ°’ (`current_lr`, `current_bs`)μ„ λ°°μ—΄μ—μ„ κ°€μ Έμµλ‹λ‹¤.
    *   **μ‹¤ν–‰:** κ°€μ Έμ¨ νλΌλ―Έν„° κ°’μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ  μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤ (μ—¬κΈ°μ„λ” `echo`λ΅ μ¶λ ¥).

*   **μ¤ν¬λ¦½νΈ μ μ¶ λ° ν™•μΈ:**
    ```bash
    # νν‹°μ… μ΄λ¦„, λ…Έλ“ λ©λ΅(--nodelist) λ“±μ„ λ© μ„λ²„ ν™κ²½μ— λ§κ² μμ •ν–λ”μ§€ ν™•μΈ!
    nano 4-jobarray_sbatch.sh # ν•„μ”μ‹ μμ •
    sbatch 4-jobarray_sbatch.sh
    squeue -u $USER # μ‘μ—… μƒνƒ ν™•μΈ (JOBIDμ— _[1-4] λλ” JOBID_1, JOBID_2 ... ν•μ‹ ν™•μΈ)
    # μ μ‹ κΈ°λ‹¤λ¦° ν›„...
    ls -l logs/systematic/ # λ΅κ·Έ νμΌ μƒμ„± ν™•μΈ 
    cat logs/systematic/<λ΅κ·ΈνμΌλ…>.o # λ΅κ·Έ νμΌ λ‚΄μ© ν™•μΈ (Task ID λ³„λ΅ λ‹¤λ¥Έ νλΌλ―Έν„° μ¶λ ¥ ν™•μΈ)
    ```
*   **ν•µμ‹¬:** **`--array` μµμ…**μΌλ΅ Taskλ¥Ό μƒμ„±ν•κ³ , μ¤ν¬λ¦½νΈ λ‚΄μ—μ„ **`$SLURM_ARRAY_TASK_ID`**λ¥Ό μ΄μ©ν•΄ κ° Taskμ λ™μ‘(μ£Όλ΅ νλΌλ―Έν„°)μ„ λ‹¤λ¥΄κ² μ •μν•λ” κ²ƒμ΄ Job Arrayμ ν•µμ‹¬ μ›λ¦¬μ…λ‹λ‹¤! ν•μ΄νΌνλΌλ―Έν„° νλ‹μ— λ§¤μ° ν¨μ¨μ μ…λ‹λ‹¤. π‘

---

### 5. μ²΄κ³„μ μΈ μ‹¤ν— μ μ¶ (λ°©λ²• 2: ν• Job λ‚΄μ—μ„ μ—¬λ¬ `srun` λ³‘λ ¬ μ‹¤ν–‰) π‘― (`5-multiple_srun_sbatch.sh`, `5-srun_multiple.sh`)

**ν•λ‚μ ν° Slurm Job μ•μ—μ„ μ—¬λ¬ κ°μ λ…λ¦½μ μΈ (μ†κ·λ¨) μ‹¤ν—λ“¤μ„ λ™μ‹μ— λ³‘λ ¬λ΅ μ‹¤ν–‰**ν•λ” κ³ κΈ‰ κΈ°λ²•μ…λ‹λ‹¤. μ ν•λ μ‹κ°„ λ‚΄μ— λ§μ€ μ‹¤ν—μ„ μ²λ¦¬ν•κ±°λ‚, ν° λ…Έλ“ ν• λ‹Ήμ„ ν¨μ¨μ μΌλ΅ μ‚¬μ©ν•κ³  μ‹¶μ„ λ• μ μ©ν•©λ‹λ‹¤. μ¤ν¬λ¦½νΈκ°€ λ‹¤μ† λ³µμ΅ν•΄μ§‘λ‹λ‹¤! π… (μ΄μ „ μ‹¤μµ μλ£μ 4λ² λ‚΄μ©κ³Ό λ™μΌν•©λ‹λ‹¤.)

*   **μ¤ν¬λ¦½νΈ μ‚΄ν΄λ³΄κΈ°:** (`cat 5-multiple_srun_sbatch.sh`)
    *   **λ€κ·λ¨ μμ› μ”μ²­:** `#SBATCH -N <ν° μ«μ>` λ΅ λ¨λ“  ν•μ„ μ‹¤ν—μ— ν•„μ”ν• λ…Έλ“λ¥Ό ν• λ²μ— μ”μ²­ν•©λ‹λ‹¤.
    *   **λ³µμ΅ν• μΈμ νμ‹±:** `-r`, `-w`, `-m` κ°™μ€ μµμ…μΌλ΅ μ—¬λ¬ ν•μ΄νΌνλΌλ―Έν„° κ°’λ“¤μ„ μ½¤λ§(,)λ΅ κµ¬λ¶„ν•μ—¬ μ…λ ¥λ°›κ³ , μ΄λ¥Ό νμ‹±ν•λ” ν•¨μλ“¤(`parse_arguments`, `split_hyperparameters` λ“±)μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤.
    *   **λ…Έλ“ μ •λ³΄ μμ§‘:** `srun ... hostname --ip-address` λ“±μ„ μ΄μ©ν•΄ ν• λ‹Ήλ°›μ€ **λ¨λ“  λ…Έλ“μ μ •λ³΄(IP, νΈμ¤νΈλ…)λ¥Ό λ―Έλ¦¬ μμ§‘**ν•μ—¬ μ„μ‹ νμΌ(`TMP_SRUN_DIR`)μ— μ €μ¥ν•©λ‹λ‹¤. (ν•µμ‹¬!)
    *   **λ£¨ν”„ λ° λ…Έλ“ ν• λ‹Ή:** ν•μ΄νΌνλΌλ―Έν„° μ΅°ν•©μ„ μνν•λ©°, κ° ν•μ„ μ‹¤ν—μ— ν•„μ”ν• λ…Έλ“ μλ§νΌ λ―Έλ¦¬ μμ§‘λ λ…Έλ“ μ •λ³΄μ—μ„ **μμ°¨μ μΌλ΅ λ…Έλ“λ¥Ό ν• λ‹Ή**ν•©λ‹λ‹¤. (`ip_line = $(sed ...)` λ¶€λ¶„)
    *   **λ°±κ·ΈλΌμ΄λ“ `srun` μ‹¤ν–‰:** κ° ν•μ„ μ‹¤ν—μ— λ€ν•΄ `srun` λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ, **λ§¨ λ’¤μ— `&`λ¥Ό λ¶™μ—¬ λ°±κ·ΈλΌμ΄λ“λ΅ μ‹¤ν–‰**μ‹ν‚µλ‹λ‹¤! μ΄λ ‡κ² ν•λ©΄ λ‹¤μ ν•μ„ μ‹¤ν— `srun`μ΄ μ¦‰μ‹ μ‹¤ν–‰λ  μ μμµλ‹λ‹¤.
    *   **`wait` λ…λ Ήμ–΄:** λ¨λ“  λ°±κ·ΈλΌμ΄λ“ `srun` μ‘μ—…μ΄ λλ‚  λ•κΉμ§€ λ©”μΈ μ¤ν¬λ¦½νΈκ°€ μΆ…λ£λμ§€ μ•λ„λ΅ κΈ°λ‹¤λ¦½λ‹λ‹¤.
    *   **κ°λ³„ λ΅κ·Έ:** κ° `srun` λ…λ Ήμ–΄μ `--output`, `--error` μµμ…μ— νλΌλ―Έν„° κ°’μ„ ν¬ν•¨μ‹μΌ λ΅κ·Έ νμΌμ„ λ¶„λ¦¬ν•©λ‹λ‹¤.
    *   `5-srun_multiple.sh` μ¤ν¬λ¦½νΈλ” κ° ν•μ„ μ‹¤ν—μ Taskμ—μ„ μ‹¤ν–‰λλ©°, μ „λ‹¬λ°›μ€ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

*   **μ‹¤ν–‰ λ°©λ²• λ° ν™•μΈ:** (μ΄ μ¤ν¬λ¦½νΈλ” μ„¤μ •μ΄ λ³µμ΅ν•μ—¬ μ‹¤μ  μ μ¶λ³΄λ‹¤λ” κµ¬μ΅° μ΄ν•΄μ— μ§‘μ¤‘ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.)
    ```bash
    # μ¤ν¬λ¦½νΈ λ‚΄λ¶€μ νν‹°μ…, λ…Έλ“ μ λ“±μ„ λ§¤μ° μ‹ μ¤‘ν•κ² μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤!
    # μ‹¤μ  μ μ¶λ³΄λ‹¤λ” μ•„λμ²λΌ νλΌλ―Έν„°λ¥Ό μ§μ ‘ μ „λ‹¬ν•λ©° μ‹¤ν–‰ νλ¦„μ„ λ³΄λ” κ²ƒμ΄ μ μ©ν•  μ μμµλ‹λ‹¤.
    # (λ‹¨, sbatchλ΅ μ μ¶ν•μ§€ μ•μΌλ©΄ SLURM ν™κ²½ λ³€μκ°€ μ—†μ–΄μ„ μΌλ¶€ κΈ°λ¥μ€ λ™μ‘ν•μ§€ μ•μ)
    # bash 5-multiple_srun_sbatch.sh -n 1 -r 0.1,0.01 -w 0.1 -m 0.4

    # μ‹¤μ  μ μ¶ μμ‹ (2κ° μ‹¤ν—, κ° μ‹¤ν—λ‹Ή 1λ…Έλ“ μ‚¬μ©, μ΄ 2λ…Έλ“ μ”μ²­ κ°€μ •)
    # nano 5-multiple_srun_sbatch.sh # νν‹°μ…, λ…Έλ“ μ λ“± μμ •
    # sbatch --nodes=2 5-multiple_srun_sbatch.sh -n 1 -r 0.1,0.01 -w 0.1 -m 0.4

    # squeue ν™•μΈ
    # μ μ‹ κΈ°λ‹¤λ¦° ν›„ logs/multiple_srun/ λ””λ ‰ν† λ¦¬ ν™•μΈ
    # ls -l logs/multiple_srun/
    # κ° λ΅κ·Έ νμΌ ν™•μΈ
    ```
*   **ν•µμ‹¬:** ν•λ‚μ ν° Slurm μμ› ν• λ‹Ή λ‚΄μ—μ„, λ…Έλ“ μ •λ³΄λ¥Ό μ§μ ‘ κ΄€λ¦¬ν•κ³  `srun`μ„ λ°±κ·ΈλΌμ΄λ“λ΅ μ‹¤ν–‰ν•μ—¬ **μ—¬λ¬ λ…λ¦½ μ‹¤ν—μ„ λ™μ‹μ— μν–‰**ν•λ” λ°©λ²•μ…λ‹λ‹¤. μ¤ν¬λ¦½νΈ λ³µμ΅λ„κ°€ λ†’μ§€λ§ μμ› ν™μ©λ¥ μ„ κ·Ήλ€ν™”ν•  μ μμµλ‹λ‹¤. Job Arrayμ™€λ” λ‹¤λ¥Έ μ ‘κ·Ό λ°©μ‹μ…λ‹λ‹¤.

---

## π‰ μ‹¤μµ μ™„λ£! π‰

μ¶•ν•ν•©λ‹λ‹¤! Slurm μ¤ν¬λ¦½νΈλ¥Ό μ‘μ„±ν•κ³  μ μ¶ν•λ” λ‹¤μ–‘ν• λ°©λ²•λ“¤μ„ ν•¨κ» μ‚΄ν΄λ³΄μ•μµλ‹λ‹¤. π’

**μ¤λ λ°°μ΄ κ²ƒ λ³µμµ:**

*   **κΈ°λ³Έ:** λ‹¨μΌ μ‘μ—… μ μ¶ λ° ν™•μΈ (`1-*.sh`)
*   **λ©€ν‹°λ…Έλ“:** `srun`μ„ μ΄μ©ν• λ¶„μ‚° μ‘μ—… μ‹¤ν–‰ (`2-*.sh`)
*   **μ²΄κ³„μ  μ‹¤ν— (λ°©λ²• 1: μ™Έλ¶€ μ¤ν¬λ¦½νΈ):** μ—¬λ¬ λ…λ¦½ Job μ μ¶ (`3-*.sh`)
*   **μ²΄κ³„μ  μ‹¤ν— (λ°©λ²• 2: Job Array):** κ°€μ¥ ν‘μ¤€μ μΈ λ°©λ²•! (`4-*.sh`) β¨
*   **μ²΄κ³„μ  μ‹¤ν— (λ°©λ²• 3: λ³‘λ ¬ srun):** ν• Job λ‚΄μ—μ„ μ—¬λ¬ μ‹¤ν— λ™μ‹ μ‹¤ν–‰ (`5-*.sh`)

μ΄μ  κ° λ°©λ²•μ νΉμ§•κ³Ό μ¥λ‹¨μ μ„ μ΄ν•΄ν•μ…¨μΌλ‹, μ—¬λ¬λ¶„μ μ—°κµ¬ μƒν™©κ³Ό λ©μ μ— κ°€μ¥ μ ν•©ν• λ°©λ²•μ„ μ„ νƒν•μ—¬ ν¨μ¨μ μΌλ΅ HPC μμ›μ„ ν™μ©ν•μ‹¤ μ μμ„ κ±°μμ”! π νΉν **Job Array**λ” ν•μ΄νΌνλΌλ―Έν„° νλ‹ λ“± λ§μ€ κ²½μ°μ— κ°€μ¥ μ μ©ν•κ² μ‚¬μ©λ  μ μμΌλ‹ κΌ­ κΈ°μ–µν•΄μ£Όμ„Έμ”!

κ¶κΈν• μ μ΄ μλ‹¤λ©΄ μ–Έμ λ“ μ§€ νΈν•κ² μ§λ¬Έν•΄μ£Όμ„Έμ”! μκ³ ν•μ…¨μµλ‹λ‹¤! π¥°
